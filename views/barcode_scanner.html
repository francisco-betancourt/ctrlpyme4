
<form id="barcode_scanner_form">
  <div class="form-group">
    <div class="input-group">
      <div class="input-group-addon"><i class="fa fa-barcode"></i></div>
      <input type="text" class="form-control" id="barcode" placeholder="{{=T('Scan a Barcode')}}">
    </div>
  </div>
</form>


<script>
  function setup_scanner(success_callback, fail_callback, requirement, url) {
    var items = false;
    if (!url) {
      url = '{{=URL("item", "find_by_code", extension="json")}}/';
      items = true
    }
    $('#barcode_scanner_form').on('submit', function(event) {
      event.preventDefault();

      var barcode = $('#barcode').val();

      if ((requirement && requirement(barcode)) || !requirement) {
        $.ajax({
          url: url + barcode
        })
        .done(function(data) {
          if (items) {
            success_callback(data.item, barcode);
          }
          else {
            success_callback(data, barcode);
          }
          $('#barcode').val('');
        })
        .fail(function(data) {
          fail_callback(data, barcode);
        });
      }

      return false;
    });
  };
</script>
