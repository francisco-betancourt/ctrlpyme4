<!DOCTYPE html>
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js" lang="{{=T.accepted_language or 'en'}}"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <!-- www.phpied.com/conditional-comments-block-downloads/ -->
    <!-- Always force latest IE rendering engine
         (even in intranet) & Chrome Frame
         Remove this if you use the .htaccess -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge{{=not request.is_local and ',chrome=1' or ''}}">
    <!--  Mobile Viewport Fix
          j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag
          device-width: Occupy full width of the screen in its current orientation
          initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
          user-scalable = yes allows the user to zoom in -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>{{=response.title or request.application}}</title>
    <!-- http://dev.w3.org/html5/markup/meta.name.html -->
    <meta name="application-name" content="{{=request.application}}">
    <!-- Speaking of Google, don't forget to set your site up:
         http://google.com/webmasters -->
    <meta name="google-site-verification" content="">
    <!-- include stylesheets -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="{{=URL('static','css/ctrlpyme_base.css')}}"/>
    <link rel="stylesheet" href="{{=URL('static','css/ctrlpyme.css')}}"/>
    <link rel="stylesheet" href="{{=URL('static','css/ticket.css')}}"/>
    <link rel="stylesheet" href="{{=URL('static','css/bootstrap-treeview.min.css')}}"/>
    <link rel="shortcut icon" href="{{=URL('static','images/favicon.ico')}}" type="image/x-icon">
    <link rel="apple-touch-icon" href="{{=URL('static','images/favicon.png')}}">
    <!-- All JavaScript at the bottom, except for Modernizr which enables
         HTML5 elements & feature detects -->
    <script src="{{=URL('static','js/modernizr-2.8.3.min.js')}}"></script>
    <!--[if lt IE 9]>
        <script src="{{=URL('static','js/respond-1.4.2.min.js')}}"></script>
        <![endif]-->
    <!-- Favicons -->
    {{include 'web2py_ajax.html'}} <!-- this includes jquery.js, calendar.js/.css and web2py.js -->
    <script src="{{=URL('static','js/bootstrap-treeview.min.js')}}"></script>

    {{block head}}{{end}}
    {{
    # using sidebars need to know what sidebar you want to use
    mc0 = 'col-md-12'
    mc1 = 'col-md-9'
    mc2 = 'col-md-6'
    left_sidebar_enabled = globals().get('left_sidebar_enabled', False)
    right_sidebar_enabled = globals().get('right_sidebar_enabled', False)
      middle_column = {0: mc0, 1: mc1, 2: mc2}[
    (left_sidebar_enabled and 1 or 0)+(right_sidebar_enabled and 1 or 0)]
    }}

    {{include "style.html"}}

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="{{=COMPANY_NAME}}">
    <link rel="apple-touch-icon" href="">

    <!-- Tile icon for Win8 (144x144) -->
    <meta name="msapplication-TileImage" content="">
  </head>

  <body>
    <!--[if lt IE 8]><p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p><![endif]-->
    {{if response.flash and not session.info:}}
      {{session.info = {'text': response.flash} }}
    {{pass}}



     {{if session.info:}}
       <div class="info-card panel panel-default" id="info_card">
         <div class="panel-body">
           <div><i class="fa fa-times close" id="info_close"></i></div>
           <div id="info_card__text">{{=session.info['text'] or ''}}</div>
             {{if session.info.has_key('button') and session.info['button'].has_key('href'):}}
             <div id="info_card__btn_container">
             <p></p>
               <a id="info_card__btn" class="btn btn-block btn-default info-btn" href=" {{=session.info['button']['ref']}}"
                   target="{{=session.info['button']['target'] if session.info['button'].has_key('target') else ''}}">
               {{=session.info['button']['text'] or ''}}
             </a>
           </div>
           {{pass}}
         </div>
       </div>
      {{else:}}
        <div class="info-card panel panel-default" id="info_card" hidden>
          <div class="panel-body">
            <div><i class="fa fa-times close" id="info_close"></i></div>
            <div id="info_card__text"></div>
            <div id="info_card__btn_container">
              <p></p>
              <a id="info_card__btn" class="btn btn-block btn-default info-btn" href=""></a>
            </div>
          </div>
        </div>
     {{pass}}
    {{session.info = None}}

    <script>
      $('#info_close').click(function(event) {
        $('#info_card').fadeToggle();
      })

      function info_card(msg, button, context) {
        $('#info_card__text').text(msg);
        if (! button) {
          $('#info_card__btn_container').hide();
        }
        else {
          $('#info_card__btn_container').show();
        }
        if (context) {
          // $('#info_card').addClass(context);
        }
        $('#info_card').fadeIn();
      }
    </script>

    <!-- Navbar ======================================= -->

    {{include "navbar.html"}}


    <!-- Masthead ===================================== -->
    {{block header}}
    {{end}}
    <!-- Main ========================================= -->
    <!-- Begin page content -->
    <div class="container-fluid main-container">

      <div class="modal fade" tabindex="-1" role="dialog" id="common_modal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="modal_title">{{=T('Modal')}}</h4>
            </div>
            <div class="modal-body" id="modal_body">
            </div>
            <div class="modal-footer" id="modal_footer">
            </div>
          </div>
        </div>
      </div>

      <script>
        function set_modal(title, body, footer) {
          $('#modal_title').text(title);
          $('#modal_body').text(body);
          if (footer) {
            $('#modal_footer').text(footer);
          }
        }

        function show_modal() {
          $('#common_modal').modal();
        }
      </script>


      {{if left_sidebar_enabled:}}
        <div class="col-md-3 col-sm-5 left-sidebar">
            {{block left_sidebar}}
            <h3>Left Sidebar</h3>
            <p></p>
            {{end}}
        </div>
      {{pass}}

      <!-- FAB variables -->
      {{fab_action = URL('create')}}
      {{fab_icon = 'plus'}}
      {{fab_options = None}}
      {{fab_options_mode = None}}

      {{core_action = URL('create')}}
      {{core_action_icon = 'plus'}}
      {{core_options = None}}

      {{context_sidebar = True}}

      <div class="{{=middle_column}}">
        {{block center}}
        {{include}}
        {{end}}
      </div>



      <style>
        #bag_container {
          background-color: #F0F0F0;
          min-width: 300px;
          max-width: 500px;
          position: fixed;
          right: 0px;
          z-index: 1000;
          height: 100vh;
          top: 0px;
          overflow-y: scroll;

          box-shadow: 0px 0px 8px rgba(0,0,0,.3);
        }

        .bag-container {
          padding: 8px;
        }
      </style>

      {{
        try:
          include_bag
        except NameError:
          include_bag = True
        pass
      }}

      {{if include_bag and request.controller != 'appadmin':}}
        <secction id="bag_container" hidden>
          <div class="bag-container">
            {{if auth.is_logged_in():}}
              {{auto_bag_selection()}}

              {{if auth.has_membership('Employee'):}}
                {{if not session.store:}}
                  <h2>{{=T('Bag')}}</h2>
                  {{=T('You need to')}} <a href="{{=URL('user', 'store_selection', vars=dict(_next=URL(request.controller, request.function)))}}">{{=T('Select a store')}}</a> {{=T('in order to sell items')}}
                {{elif not auth.has_membership('Sales bags') or not auth.has_membership('Admin'):}}
                  <h2>{{=T('Bag')}}</h2>
                  {{=T("Sorry you can't sell")}}
                {{else:}}
                  {{include 'bag.html'}}
                {{pass}}
              {{elif auth.has_membership('Clients'):}}
                {{include 'simple_client_bag.html'}}
              {{pass}}
            {{else:}}
              <h2>{{=T('Bag')}}</h2>
              <a href="{{=URL('default', 'user/login')}}">{{=T('Login')}}</a>  {{=T('or')}} <a href="{{=URL('default', 'user/register')}}">{{=T('Register')}}</a> {{=T('to add items to your bag')}}
            {{pass}}
          </div>
        </secction>

        <script>
          $('#bag_container').css("padding-top", $('nav').height());
          $('#bag_container').css("padding-bottom", $('nav').height());
        </script>
      {{pass}}


    </div>

    {{block footer}} <!-- this is default footer -->
    <footer class="footer">
      <div class="container-fluid">
        <div class="copyright pull-left">{{=T('Copyright')}} &#169; {{=request.now.year}}</div>
          <div id="poweredBy" class="pull-right">
            {{=T('Powered by')}}
            <a href="http://www.web2py.com/">web2py</a>
          </div>
      </div>
    </footer>
    {{end}}
    <!-- The javascript =============================== -->
    <script src="{{=URL('static','js/bootstrap.min.js')}}"></script>
    <script src="{{=URL('static','js/web2py-bootstrap3.js')}}"></script>
    {{block page_js}}{{end page_js}}
    {{if response.google_analytics_id:}}
    <!-- Analytics ==================================== -->
    <script src="{{=URL('static','js/analytics.min.js')}}"></script>

    <script type="text/javascript">
      analytics.initialize({
      'Google Analytics':{trackingId:'{{=response.google_analytics_id}}'}
      });
    </script>
    {{pass}}

    <script>
      $('#tabs a').click(function (e) {
        e.preventDefault()
        $(this).tab('show')
      });


      var countChecked = function() {
       var n = $( ".row_checkbox:checked" ).length;
       // in this case we have to show the selection options
       if (n > 0) {
         $('#selection_menu').show();
       }
       else {
         $('#selection_menu').hide();
       }
     };

     $('.row_checkbox').click(function(event) {
       countChecked();
     });

     $('#master_checkbox').click(function(event) {
       if (event.target.checked) {
         checkboxes = $('.row_checkbox');
         $.each(checkboxes, function(i, element) {
           element.checked = true;
         });
       }
       else {
         checkboxes = $('.row_checkbox');
         $.each(checkboxes, function(i, element) {
           element.checked = false;
         });
       }
       countChecked();
     });

     {{vars_string = URL(vars=request.vars).split('?')[1] if request.vars else ""}}

     function delete_rows(ids, controller, vars) {
       if(confirm('{{=T("Are you sure you want to delete the selected elements?")}}')) {
         var delete_url = '{{=URL("delete")}}' + ids + '?' + vars;
         window.location.href = delete_url;
       }
     };

     $('#delete').click(function(event) {
       var ids = '/';
       $.each( $(".row_checkbox:checked"), function(i, item) {
         ids += item.value + '/';
       });
       delete_rows(ids, "", "{{=vars_string}}");
     });

    </script>

  </body>
</html>
