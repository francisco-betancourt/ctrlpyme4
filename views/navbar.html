<style>
  nav {
    /*background-color: #3672B6;
    background-color: #368DB6;*/
    color: white;
    position: fixed;
    top: 0px;
    height: 54px;
    min-height: 54px;
    line-height: 54px;
    padding-left: 16px;
    padding-right: 16px;
    width: 100%;

    box-shadow: 0px 4px 4px rgba(0,0,0,.2);

    z-index: 100000;
  }

  nav > span {
    display: inline-block;
    height: 54px;
    min-height: 54px;
  }

  .main-menu {
    /*overflow-x: scroll;*/
  }

  #menu_options {
    overflow-y: scroll;
    max-width: 400px;
  }

  .menu-element {
    display: inline-block;
    padding-left: 8px;
    padding-right: 8px;
    outline-style: none;
  }

  .menu-element a {
    outline-style: none;

    color: white;
    text-decoration: none;
    padding-right: 8px;
  }

  .submenu {
    position: fixed;
    margin-top: -1px;
    display: block;
    height: 54px;
    padding-left: 8px;
    padding-right: 8px;
    box-shadow: 0px 4px 4px rgba(0,0,0,.2);

  }


  .right-menu {
    display: flex;
  }

  .nav-logo {
    font-size: 18px;
  }

  #search_form {
    margin-bottom: 0px;
    margin-top: 9.5px;
  }
</style>

<nav>
  <span class="main-menu">
    <span class="menu-element nav-logo">
      {{=response.logo}}
    </span>

    <span id="menu_options">
      {{if response.menu:}}
        {{i = 0}}
        {{for menu in response.menu:}}
          <span class="menu-element" id="menu_{{=i}}">
            {{menu_link = menu[2] if menu[2] else "#"}}
            <a href="{{=menu_link}}" onclick="toggle_submenu({{=i}});">
              {{=menu[0]}}
              {{if menu[3]:}}
                <i class="fa fa-angle-right"></i>
              {{pass}}
            </a>
            {{if menu[3]:}}
              <span class="submenu primary-color-dim" id="submenu_{{=i}}">
                {{for submenu in menu[3]:}}
                  <span class="menu-element">
                    <a href="{{=submenu[2]}}"> {{=submenu[0]}}</a>
                  </span>
                {{pass}}
              </span>
            {{pass}}
          </span>
          {{ i += 1}}
        {{pass}}
      {{pass}}
    </span>

  </span>

  <span class="right-menu right">
    <span class="menu-element">{{include "search_bar.html"}}</span>
    <span class="menu-element" onclick="$('#bag_container').toggle();"><i class="fa fa-shopping-cart"></i></span>
  </span>
</nav>


<script>
  $('.submenu').hide();

  function toggle_submenu(index) {
    var display = $('#submenu_' + index).css('display');
    $('.submenu').hide();
    if (display == 'none') {
      $('#submenu_' + index).show();
      // $('#menu_' + index).css('background-color', $('#submenu_' + index).css('background-color'));
    }
    else {
      $('#submenu_' + index).hide();
    }
  }
</script>
