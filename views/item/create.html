{{extend 'layout.html'}}
<h2>{{=T("New Item")}}</h2>
{{=form}}


<!-- <form action="" class="form-horizontal">
  <div class="form-group">
    <label>{{=T('Bundle items')}}</label>
    <div class="col-sm-9">
      <input type="text" id="bundle_item_code" class="form-control"
             placeholder="{{=T('Scan code...')}}">
      <div class="bundle_items_list"></div>
    </div>

  </div>
</form> -->


<script type="text/javascript">
  $('#categories_tree').treeview({
    data: categories_tree_data,
    checkedIcon: 'fa fa-check-square-o',
    uncheckedIcon: 'fa fa-square-o',
    expandIcon: 'fa fa-plus',
    collapseIcon: 'fa fa-minus',
    showCheckbox: true,
    highlightSelected: false,
    levels: 1
  });

  $('#categories_tree').bind('nodeChecked nodeUnchecked', function(event, node) {
    var selected = $('#categories_tree').treeview('getChecked');
    var selected_categories = "";
    for(var i = 0; i < selected.length; i++) {
      selected_categories += selected[i].category_id;
      if (i < selected.length - 1) {
        selected_categories += ',';
      }
    }
    $('#categories_selected').prop('value', selected_categories);
    $.ajax({
      url: "{{=URL('trait_selector_data')}}.json?categories=" + selected_categories
    })
    .done(function(data) {
      if (data.status == "1") {
      }
      $('#traits_tree').treeview({
        data: data.traits,
        multiSelect: true,
        selectedIcon: 'fa fa-check',
        expandIcon: 'fa fa-plus',
        collapseIcon: 'fa fa-minus',
        highlightSelected: false,
        levels: 1
      });

      $('#traits_tree').bind('nodeSelected nodeUnselected', function(event, node) {
        var siblings = $('#traits_tree').treeview('getSiblings', node);
        var selected_traits = "";
        for(var i = 0; i < siblings.length; i++) {
          $('#traits_tree').treeview('unselectNode', [ siblings[i], { silent: true } ]);
        }
        var selected = $('#traits_tree').treeview('getSelected');
        var selected_traits = "";
        for(var i = 0; i < selected.length; i++) {
          selected_traits += selected[i].trait_id;
          if (i < selected.length - 1) {
            selected_traits += ',';
          }
        }
        $('#traits_selected').prop('value', selected_traits);
        console.log(selected_traits);
      });

    });
  });



  $('#category_search').bind('change paste keyup', function(event) {
    var pattern = $(this).val()
    $('#categories_tree').treeview('collapseAll', { silent: true });
    $('#categories_tree').treeview('search', [pattern , {
      ignoreCase: true,     // case insensitive
      exactMatch: false,    // like or equals
      revealResults: true  // reveal matching nodes
    }]);
  })

  $("#item_is_bundle").on('click', function(event) {
    console.log(event.target.checked);
    if (event.target.checked) {
      $("#bundle_items_form_group").show();
    }
    else {
      $("#bundle_items_form_group").hide();
    }
  });
  //
  // $("form :submit").on("click", function(event) {
  //   $("form").on("submit", function(event) {
  //     console.log("real submit");
  //     return true;
  //   });
  //   $("form").submit();
  // });
</script>
